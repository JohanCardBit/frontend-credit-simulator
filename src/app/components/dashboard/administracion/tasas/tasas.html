<div class="tasas-container">

  <!-- Encabezado -->
  <div class="header-tasas">
    <h2>Tasas de interÃ©s</h2>
    <button (click)="limpiarModal()" class="btn-crear" data-bs-toggle="modal" data-bs-target="#modal-crear-tasa">+ Crear
      nueva tasa</button>
  </div>

  <!-- Contenedor de tarjetas -->
  <div class="cards-tasas">

    @for (item of tasasObtenidas; track $index) {
    <div class="card-tasa glass">
      <div class="card-header">
        <span class="tipo">{{item.type == 'fixed' ? 'Fija' : 'Variable'}}</span>
        <div class="acciones">
          <button (click)="verTasa(item._id)" class="icon-btn" data-bs-toggle="modal"
            data-bs-target="#modal-editar-tasa">âœï¸</button>
          <button (click)="eliminarTasa(item._id)" class="icon-btn eliminar">ğŸ—‘ï¸</button>
        </div>
      </div>

      <div class="card-body">
        <p><strong>Tasa Base:</strong> {{item.baseRate}} % anual</p>
        <p><strong>Margen:</strong> {{item.spread}} %</p>
        @if (item.type == 'variable') {
        <p><strong>Rango:</strong> {{item.minRate}} % - {{item.maxRate}} %</p>
        <p><strong>Volatilidad:</strong> {{item.volatility}} %</p>
        }
        <p><strong>Seguro de Vida:</strong> {{ (item.sure * 100) | number:'1.2-3' }} %</p>
        <p><strong>Desde:</strong> {{item.startDate.split('T')[0]
          }}</p>
        <p><strong>Hasta:</strong> {{item.endDate.split('T')[0]}}</p>
      </div>
    </div>
    }
  </div>
</div>



<!-- MODAL CREAR NUEVA TASA -->
<div class="modal fade" id="modal-crear-tasa" data-bs-backdrop="false">
  <div class="modal-dialog">
    <div class="modal-content glass">

      <div class="modal-header">
        <h5 class="modal-title">Crear nueva tasa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" [formGroup]="tasasForm">

        <label class="form-label">Tipo de tasa</label>
        <select class="form-control" formControlName="type">
          <option value="fixed">Fija</option>
          <option value="variable">Variable</option>
        </select>

        <label class="form-label mt-3">Tasa de interes base (%)</label>
        <input type="number" class="form-control" formControlName="baseRate" placeholder="Ej: 12">

        <label class="form-label mt-3">margen (%)</label>
        <input type="number" class="form-control" formControlName="spread" placeholder="Ej: 1.5">

        @if (isVariable) {

        <label class="form-label mt-3">Volatilidad (%)</label>
        <input type="number" class="form-control" formControlName="volatility" placeholder="Ej: 0.5">

        <label class="form-label mt-3">Tasa minima (%)</label>
        <input type="number" class="form-control" formControlName="minRate" placeholder="Ej: 8">

        <label class="form-label mt-3">Tasa Maxima (%)</label>
        <input type="number" class="form-control" formControlName="maxRate" placeholder="Ej: 15">
        }

        <label class="form-label mt-3">Seguro de Vida (%)</label>
        <input type="number" class="form-control" formControlName="sure" placeholder="Ej: 0.35">


        <label class="form-label mt-3">Desde</label>
        <input type="date" class="form-control" formControlName="startDate">

        <label class="form-label mt-3">Hasta</label>
        <input type="date" class="form-control" formControlName="endDate">

      </div>


      <div class="modal-footer">
        <button (click)="createRates()" class="btn btn-primary" data-bs-dismiss="modal">Crear</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>

    </div>
  </div>
</div>



<!-- MODAL EDITAR TASA -->
<div class="modal fade" id="modal-editar-tasa" data-bs-backdrop="false">
  <div class="modal-dialog">
    <div class="modal-content glass">

      <div class="modal-header">
        <h5 class="modal-title">Modificar tasa {{isVariable == true ? 'Variable' : 'Fija'}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" [formGroup]="tasasForm">

        <label class="form-label mt-3">Tasa de interes base (%)</label>
        <input type="number" class="form-control" formControlName="baseRate" placeholder="Ej: 12">

        <label class="form-label mt-3">margen (%)</label>
        <input type="number" class="form-control" formControlName="spread" placeholder="Ej: 1.5">

        @if (isVariable) {

        <label class="form-label mt-3">Volatilidad (%)</label>
        <input type="number" class="form-control" formControlName="volatility" placeholder="Ej: 0.5">

        <label class="form-label mt-3">Tasa minima (%)</label>
        <input type="number" class="form-control" formControlName="minRate" placeholder="Ej: 8">

        <label class="form-label mt-3">Tasa Maxima (%)</label>
        <input type="number" class="form-control" formControlName="maxRate" placeholder="Ej: 15">
        }

        <label class="form-label mt-3">Seguro de Vida (%)</label>
        <input type="number" class="form-control" formControlName="sure" placeholder="Ej: 0.35">

        <label class="form-label mt-3">Desde</label>
        <input type="date" class="form-control" formControlName="startDate">

        <label class="form-label mt-3">Hasta</label>
        <input type="date" class="form-control" formControlName="endDate">

      </div>

      <div class="modal-footer">
        <button (click)="actualizarTasa()" class="btn btn-primary" data-bs-dismiss="modal">Guardar</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>

    </div>
  </div>
</div>
